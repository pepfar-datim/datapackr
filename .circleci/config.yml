version: 2.1
description: Datapackr Test Suite
jobs:
  build:
    docker:
      - image: rocker/verse:3.6.0
    steps:
      - checkout
      - run: 
         name: Install curl sytem deps
         command: sudo apt-get update && sudo apt-get -qq -y install libcurl4-openssl-dev libxml2-dev libcurl3 libsodium-dev
      - run:
          name: Install package dependencies
          command: R -e "install.packages('renv')"
      - run:
          name: Restore from lock file
          command: R -e "renv::restore()"
      - run:
          name: Build package
          command: R CMD build .
      - run:
          name: Check package
          command: R CMD check *tar.gz
